!function(){"use strict";var t,e="undefined"!=typeof module&&module.exports;t=e?require("maptalks"):window.maptalks,t.ui.Toolbox=t.ui.UIComponent.extend({statics:{single:!0},options:{eventsToStop:"mousedown dblclick click",autoPan:!1,style:"maptalks-toolbox",vertical:!1,items:[]},initialize:function(e){t.Util.setOptions(this,e)},setItems:function(t){return this.options.items=t,this},getItems:function(){return this.options.items},getSize:function(){return this._size?this._size.copy():null},buildOn:function(e){var o=t.DomUtil.createEl("div");this.options.style&&t.DomUtil.addClass(o,this.options.style);var i=this.options.items;if(i&&i.length>0){for(var n=0,l=0,s=0,r=i.length;r>s;s++){var c=i[s];if(!c.hidden){c.vertical=c.vertical||this.options.vertical;var u=this._createMenuDom(c);o.appendChild(u),n+=(c.width||0)+4,l+=(c.height||0)+2}}this.options.vertical?o.style.height=l+"px":o.style.width=n+"px"}return this._toolboxDom=o,o},_getWidth:function(){var t=160,e=this.options.width;return e||(e=t),e},getEvents:function(){return{"_zoomstart _zoomend _movestart":this.hide}},onDomRemove:function(){this._removeDomEvents(this._toolboxDom)},_removeDomEvents:function(t){if(t)for(var e=t.childNodes,o=0,i=e.length;i>o;o++){var n=e[o];n&&n.childNodes.length>0?this._removeDomEvents(n):this._removeEventsFromDom(n)}},_removeEventsFromDom:function(e){t.DomUtil.off(e,"click").off(e,"mouseover").off(e,"mouseout").off(e,"mousedown").off(e,"dblclick").off(e,"contextmenu"),t.DomUtil.removeDomNode(e),e=null},_createMenuDom:function(e,o){var i=t.DomUtil.createEl("span");o&&(i=t.DomUtil.createEl(o));var n=e.width||16,l=e.height||16,s=e.vertical;void 0!==s&&null!=s||(s=!1);var r="inline-block";s&&(r="block"),i.style.cssText="text-align:center;display:-moz-inline-box;display:"+r+";width:"+n+"px;height:"+l+"px;",t.DomUtil.addClass(i,"maptalks-toolbox-button"),i.appendChild(this._createIconDom(e)),e.click&&t.DomUtil.on(i,"click",e.click,this),e.mouseover&&t.DomUtil.on(i,"mouseover",e.mouseover,this),e.mouseout&&t.DomUtil.on(i,"mouseout",e.mouseout,this),e.mousedown&&t.DomUtil.on(i,"mousedown",e.mousedown,this),e.mouseup&&t.DomUtil.on(i,"mouseup",e.mouseup,this),this._addEventToMenuItem(i,e);var c=this,u=e.trigger||"click";return"click"===u?t.DomUtil.on(i,"click",function(){c._showDropMenu(i,e)},this):"mouseover"===u&&t.DomUtil.on(i,"mouseover",function(){c._showDropMenu(i,e)},this),i},_addEventToMenuItem:function(e,o){if(o.children&&o.children.length>0){var i=this,n=i._createDropMenu(e,o),l=o.trigger;"click"===l?(t.DomUtil.on(e,"click",function(){t.DomUtil.setStyle(n,"display : block")},this),t.DomUtil.on(n,"mouseover",function(){t.DomUtil.setStyle(n,"display : block")},this)):"mouseover"===l&&t.DomUtil.on(e,"mouseover",function(){t.DomUtil.setStyle(n,"display : block")},this),t.DomUtil.on(e,"mouseout",function(){t.DomUtil.setStyle(n,"display : none"),n.style.cssText="position: absolute; top: -10000px; left: -10000px;"},this),t.DomUtil.on(n,"mouseout mouseup",function(){t.DomUtil.setStyle(n,"display : none"),n.style.cssText="position: absolute; top: -10000px; left: -10000px;"},this)}},_showDropMenu:function(t,e){if(e.children&&e.children.length>0){var o=this._getDropdownMenuOffset(t,e),i=t.lastChild;i.style.cssText="position: absolute; top:"+o.top+"px; left:"+o.left+"px;",this.fire("showmenuend")}},_getDropdownMenuOffset:function(e,o){var i=o.children,n=16,l=16;if(i&&i.length>0)for(var s=0;s<i.length;s++){var r=i[s];n+=r.height||0,l+=r.width||0}var c=document.body.clientHeight,u=document.body.clientWidth,m=e.clientHeight,h=e.clientWidth,a=t.DomUtil.getPagePosition(e),d=a.y,p=a.x,v=o.vertical;void 0!==v&&null!=v||(v=!1);var f=m,D=h;return v?(D=p+h+l>u?-(3*h/2+l):h,f=e.offsetTop):(f=d+m+n>c?-n+m/2:m,D=e.offsetLeft),{top:f,left:D}},_createDropMenu:function(t,e){var o=e.vertical;void 0!==o&&null!=o||(o=!1);var i="position: absolute;";e.width||20,e.height||20;return i+=o?"left: -10000px;":"top: -10000px;",this._createDropMenuDom(t,e,i)},_createDropMenuDom:function(e,o,i){var n=e.children[1];n&&t.DomUtil.removeDomNode(n);var l=t.DomUtil.createElOn("ul",i),s=o.children;if(s&&s.length>0)for(var r=0,c=s.length;c>r;r++){var u=s[r];void 0===u.vertical&&(u.vertical=!(u.vertical||o.vertical)),l.appendChild(this._createMenuDom(u,"li"))}return e.appendChild(l),l},_createIconDom:function(e){var o=t.DomUtil.createEl("span"),i=e.icon,n=e.item,l=e.title,s=e.html;if(i){var r=e.iconWidth||e.width,c=e.iconHeight||e.height,u=t.DomUtil.createEl("img");return u.src=i,u.border=0,u.width=r,u.height=c,l&&(u.title=l),o.appendChild(u),n&&(s?"string"==typeof n?o.innerText=n:o.appendChild(n):o.innerText=n),o}t.DomUtil.createEl("span");return n&&("string"==typeof n?o.innerText=n:o.appendChild(n)),s&&o.appendChild(n),o}}),e&&(exports=module.exports=t.ui.Toolbox)}();